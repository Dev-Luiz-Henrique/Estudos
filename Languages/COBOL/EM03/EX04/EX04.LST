* Microsoft COBOL Version 4.5        L2.4 revision 002 13-Nov-23 17:44 Page   1
*                                       EX04.CBL
* Options: LIST(EX04.LST) ASMLIST(EX04.GRP)
     1 IDENTIFICATION DIVISION.
     2 PROGRAM-ID. EX04.
     3 AUTHOR.         LUIZ HENRIQUE DE SANTANA
     4                 GABRIEL GOMES DA CRUZ
     5                 NICOLE CARVALHO FUKUSHIMA.
     6 INSTALLATION.   FATEC-SP.
     7 DATE-WRITTEN.   11/11/2023.
     8 DATE-COMPILED. 13-Nov-23 17:44.
     9 SECURITY. APENAS O AUTOR PODE MODIFICAR.
    10*REMARKS.  LER O ARQUIVO DE ENTRADA CADCLIE, CLASSIFICANDO-O
    11*          EM ORDEM ASCENDENTE POR CPF, ALEM DE SEPARAR OS
    12*          DADOS POR ESTADO E CIDADE PRIMEIRAMENTE, GERANDO
    13*          O RELATORIO DE SAIDA RELGERAL.
    14
    15 ENVIRONMENT DIVISION.
    16 CONFIGURATION SECTION.
    17 OBJECT-COMPUTER. IBM-PC.
    18 SOURCE-COMPUTER. IBM-PC.
    19 SPECIAL-NAMES.   DECIMAL-POINT IS COMMA.
    20
    21 INPUT-OUTPUT SECTION.
    22 FILE-CONTROL.
    23 SELECT CADCLIE ASSIGN TO DISK ORGANIZATION IS LINE
    24     SEQUENTIAL.
    25 SELECT TRAB ASSIGN TO DISK.
    26 SELECT RELGERAL ASSIGN TO DISK.
    27
    28 DATA DIVISION.
    29 FILE SECTION.
    30 FD CADCLIE LABEL RECORD ARE STANDARD
    31     VALUE OF FILE-ID IS "CADCLIE.DAT".
    32 01 CAD-ENT.
    33     02 COD-ENT        PIC 9(03).
    34     02 CPF-ENT        PIC 9(11).
    35     02 NOME-ENT       PIC X(30).
    36     02 ESTADO-ENT     PIC X(02).
    37     02 CIDADE-ENT     PIC X(30).
    38     02 EMAIL-ENT      PIC X(30).
    39
    40 SD TRAB.
    41 01 CAD-TRAB.
    42   02 COD-TRAB         PIC 9(03).
    43   02 CPF-TRAB         PIC 9(11).
    44   02 RED-CPF-TRAB REDEFINES CPF-TRAB.
    45       03 NUM-CPF-TRAB  PIC 9(09).
    46       03 DIGT-CPF-TRAB PIC 99.
    47   02 NOME-TRAB        PIC X(30).
    48   02 ESTADO-TRAB      PIC X(02).
    49   02 CIDADE-TRAB      PIC X(30).
    50   02 EMAIL-TRAB       PIC X(30).
    51
    52 FD RELGERAL LABEL RECORD ARE OMMITED.
    53 01 REL-GRL         PIC X(80).
    54
    55 WORKING-STORAGE SECTION.
    56 77 FIM-ARQ PIC XXX VALUE "NAO".
    57 77 CT-LIN PIC 9(02) VALUE 21.
* Microsoft COBOL Version 4.5        L2.4 revision 002 13-Nov-23 17:44 Page   2
*                                       EX04.CBL
    58 77 CT-PAG PIC 9(02) VALUE 0.
    59 77 CT-I PIC 99 VALUE 1.
    60 77 WCIDADE-REL PIC X(30).
    61
    62 01 CAB-01.
    63     02 FILLER PIC X(23) VALUE SPACES.
    64     02 FILLER PIC X(39) VALUE
    65         "RELAÇÃO DE CLIENTES POR ESTADO/CIDADE".
    66     02 FILLER PIC X(07) VALUE SPACES.
    67     02 FILLER PIC X(05) VALUE "PAG. ".
    68     02 VAR-PAG PIC ZZ9.
    69     02 FILLER PIC X(03) VALUE SPACES.
    70
    71 01 CAB-02.
    72     02 FILLER PIC X(08) VALUE "ESTADO: ".
    73     02 ESTADO-CAB PIC X(19).
    74     02 FILLER PIC X(53) VALUE SPACES.
    75
    76 01 CAB-03.
    77     02 FILLER PIC X(08) VALUE "CIDADE: ".
    78     02 CIDADE-CAB PIC X(30).
    79     02 FILLER PIC X(42) VALUE SPACES.
    80
    81 01 CAB-04.
    82     02 FILLER PIC X(03) VALUE "CPF".
    83     02 FILLER PIC X(24) VALUE SPACES.
    84     02 FILLER PIC X(04) VALUE "NOME".
    85     02 FILLER PIC X(20) VALUE SPACES.
    86     02 FILLER PIC X(06) VALUE "E-MAIL".
    87     02 FILLER PIC X(23) VALUE SPACES.
    88
    89 01 DETALHE.
    90     02 CPF-NUM-DET PIC 999.999.999.
    91     02 FILLER PIC X(01) VALUE "-".
    92     02 CPF-DIGT-DET PIC 99.
    93     02 FILLER PIC X(03) VALUE SPACES.
    94     02 NOME-DET PIC X(30).
    95     02 FILLER PIC X(03) VALUE SPACES.
    96     02 EMAIL-DET PIC X(30).
    97
    98 01 TABELA.
    99   02 TAB-SIGLAS-ESTADOS.
   100     03 FILLER PIC X(21) VALUE "ACACRE               ".
   101     03 FILLER PIC X(21) VALUE "ALALAGOAS            ".
   102     03 FILLER PIC X(21) VALUE "AMAMAZONAS           ".
   103     03 FILLER PIC X(21) VALUE "APAMAPA              ".
   104     03 FILLER PIC X(21) VALUE "BABAHIA              ".
   105     03 FILLER PIC X(21) VALUE "CECEARA              ".
   106     03 FILLER PIC X(21) VALUE "DFDISTRITO FEDERAL   ".
   107     03 FILLER PIC X(21) VALUE "ESESPIRITO SANTO     ".
   108     03 FILLER PIC X(21) VALUE "GOGOIAS              ".
   109     03 FILLER PIC X(21) VALUE "MAMARANHAO           ".
   110     03 FILLER PIC X(21) VALUE "MGMINAS GERAIS       ".
   111     03 FILLER PIC X(21) VALUE "MSMATO GROSSO DO SUL ".
   112     03 FILLER PIC X(21) VALUE "MTMATO GROSSO        ".
   113     03 FILLER PIC X(21) VALUE "PAPARA               ".
   114     03 FILLER PIC X(21) VALUE "PBPARAIBA            ".
   115     03 FILLER PIC X(21) VALUE "PEPERNAMBUCO         ".
* Microsoft COBOL Version 4.5        L2.4 revision 002 13-Nov-23 17:44 Page   3
*                                       EX04.CBL
   116     03 FILLER PIC X(21) VALUE "PIPIAUI              ".
   117     03 FILLER PIC X(21) VALUE "PRPARANA             ".
   118     03 FILLER PIC X(21) VALUE "RJRIO DE JANEIRO     ".
   119     03 FILLER PIC X(21) VALUE "RNRIO GRANDE DO NORTE".
   120     03 FILLER PIC X(21) VALUE "RORONDONIA           ".
   121     03 FILLER PIC X(21) VALUE "RRRORAIMA            ".
   122     03 FILLER PIC X(21) VALUE "RSRIO GRANDE DO SUL  ".
   123     03 FILLER PIC X(21) VALUE "SCSANTA CATARINA     ".
   124     03 FILLER PIC X(21) VALUE "SESERGIPE            ".
   125     03 FILLER PIC X(21) VALUE "SPSAO PAULO          ".
   126     03 FILLER PIC X(21) VALUE "TOTOCANTINS          ".
   127
   128 01 TAB-ESTADOS REDEFINES TABELA OCCURS 27 TIMES.
   129     02 SIGLA  PIC X(02).
   130     02 ESTADO PIC X(19).
   131
   132 PROCEDURE DIVISION.
   133 PGM-EX04.
   134     SORT TRAB ASCENDING KEY ESTADO-TRAB, CIDADE-TRAB,
   135         CPF-TRAB USING CADCLIE OUTPUT PROCEDURE ROT-SAIDA.
   136     STOP RUN.
   137
   138 ROT-SAIDA SECTION.
   139     PERFORM INICIO.
   140     PERFORM PRINCIPAL UNTIL FIM-ARQ EQUAL "SIM".
   141     PERFORM FIM.
   142
   143 INICIO SECTION.
   144     OPEN OUTPUT RELGERAL.
   145     PERFORM LEITURA.
   146
   147 LEITURA SECTION.
   148     RETURN TRAB AT END MOVE "SIM" TO FIM-ARQ.
   149
   150 PRINCIPAL SECTION.
   151     PERFORM IMPRESSAO.
   152     PERFORM LEITURA.
   153
   154 IMPRESSAO SECTION.
   155     IF CT-LIN GREATER THAN 19
   156         PERFORM CABECALHO.
   157
   158     IF CIDADE-TRAB NOT EQUAL WCIDADE-REL
   159         MOVE CIDADE-TRAB TO WCIDADE-REL
   160         PERFORM IMP-CAB-LOCAL.
   161     PERFORM IMP-DETALHE.
   162
   163 CABECALHO SECTION.
   164     ADD 1 TO CT-PAG.
   165     MOVE CT-PAG TO VAR-PAG.
   166     MOVE SPACES TO REL-GRL.
   167     WRITE REL-GRL AFTER ADVANCING PAGE.
   168     WRITE REL-GRL FROM CAB-01 AFTER ADVANCING 1 LINE.
   169     MOVE ZEROES TO CT-LIN.
   170
   171 IMP-CAB-LOCAL SECTION.
   172     PERFORM BUSCA-ESTADO UNTIL CT-I GREATER THAN 27.
   173     MOVE 1 TO CT-I.
* Microsoft COBOL Version 4.5        L2.4 revision 002 13-Nov-23 17:44 Page   4
*                                       EX04.CBL
   174     MOVE CIDADE-TRAB TO CIDADE-CAB.
   175     WRITE REL-GRL FROM CAB-02 AFTER ADVANCING 2 LINES.
   176     WRITE REL-GRL FROM CAB-03 AFTER ADVANCING 2 LINES.
   177     WRITE REL-GRL FROM CAB-04 AFTER ADVANCING 2 LINES.
   178
   179 BUSCA-ESTADO SECTION.
   180     IF SIGLA(CT-I) EQUAL ESTADO-TRAB
   181         MOVE ESTADO(CT-I) TO ESTADO-CAB
   182         MOVE 99 TO CT-I
   183     ELSE
   184         ADD 1 TO CT-I.
   185         IF CT-I EQUAL 27
   186             MOVE "ESTADO INVALIDO    " TO ESTADO-CAB.
   187
   188 IMP-DETALHE SECTION.
   189     MOVE NUM-CPF-TRAB TO CPF-NUM-DET.
   190     MOVE DIGT-CPF-TRAB TO CPF-DIGT-DET.
   191     MOVE NOME-TRAB TO NOME-DET.
   192     MOVE EMAIL-TRAB TO EMAIL-DET.
   193     WRITE REL-GRL FROM DETALHE AFTER ADVANCING 1 LINE.
   194     ADD 1 TO CT-LIN.
   195
   196 FIM SECTION.
   197     CLOSE RELGERAL.
* Microsoft COBOL Version 4.5        L2.4 revision 002
* (C)Copyright Microsoft Corp 1984, 1991       URN AXUPA/MS0/000000
*                                              REF GNB-024050002A7
*
* Total Messages:     0
* Data:        2484     Code:         897     Dictionary:        2868
