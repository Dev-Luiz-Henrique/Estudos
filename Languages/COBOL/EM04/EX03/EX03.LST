* Microsoft COBOL Version 4.5        L2.4 revision 002 24-Nov-23 19:51 Page   1
*                                       EX03.CBL
* Options: LIST(EX03.LST) ASMLIST(EX03.GRP)
     1 IDENTIFICATION DIVISION.
     2 PROGRAM-ID.     EX03.
     3 AUTHOR.         LUIZ HENRIQUE DE SANTANA
     4                 GABRIEL GOMES DA CRUZ.
     5 INSTALLATION.   FATEC-SP.
     6 DATE-WRITTEN.   24/11/2023.
     7 DATE-COMPILED. 24-Nov-23 19:51.
     8 SECURITY.       APENAS O AUTOR PODE MODIFICA-LO.
     9*REMARKS.        FAZER O BALANCE-LINE, GERANDO UM ARQUIVO
    10*                ATUALIZADO E DOIS RELATORIOS, UM COM AS
    11*                MERCADORIAS E OUTRO COM OS ERROS.
    12
    13 ENVIRONMENT DIVISION.
    14 CONFIGURATION SECTION.
    15 SOURCE-COMPUTER. IBM-PC.
    16 OBJECT-COMPUTER. IBM-PC.
    17 SPECIAL-NAMES. DECIMAL-POINT IS COMMA.
    18
    19 INPUT-OUTPUT SECTION.
    20 FILE-CONTROL.
    21     SELECT CADMERC ASSIGN TO DISK ORGANIZATION
    22         IS LINE SEQUENTIAL.
    23     SELECT MOVMERC ASSIGN TO DISK ORGANIZATION
    24         IS LINE SEQUENTIAL.
    25     SELECT ATUMERC ASSIGN TO DISK ORGANIZATION
    26         IS LINE SEQUENTIAL.
    27     SELECT RELERRO ASSIGN TO DISK.
    28     SELECT RELMERC ASSIGN TO DISK.
    29
    30 DATA DIVISION.
    31 FILE SECTION.
    32
    33 FD CADMERC LABEL RECORD ARE STANDARD
    34     VALUE OF FILE-ID IS "CADMERC.DAT".
    35 01 REG-CADMERC.
    36     02 COD-MERC-CADMERC         PIC 9(03).
    37     02 DESCRICAO-CADMERC        PIC X(30).
    38     02 ESTOQ-MIN-CADMERC        PIC 9(03).
    39     02 QNTD-ESTOQ-CADMERC       PIC 9(03).
    40     02 PRECO-UNIT-CADMERC       PIC 9(04)V9(02).
    41
    42 FD MOVMERC LABEL RECORD ARE STANDARD
    43     VALUE OF FILE-ID IS "MOVMERC.DAT".
    44 01 REG-MOVMERC.
    45     02 COD-MERC-MOVMERC         PIC 9(03).
    46     02 DESCRICAO-MOVMERC        PIC X(30).
    47     02 ESTOQ-MIN-MOVMERC        PIC 9(03).
    48     02 QNTD-ESTOQ-MOVMERC       PIC 9(03).
    49     02 PRECO-UNIT-MOVMERC       PIC 9(04)V9(02).
    50     02 TP-ATUALIZACAO-MOVMERC   PIC X(01).
    51
    52 FD ATUMERC LABEL RECORD ARE STANDARD
    53     VALUE OF FILE-ID IS "ATUMERC.DAT".
    54 01 REG-ATUMERC.
    55   02 COD-MERC-ATUMERC           PIC 9(03).
    56   02 DESCRICAO-ATUMERC          PIC X(30).
    57   02 ESTOQ-MIN-ATUMERC          PIC 9(03).
* Microsoft COBOL Version 4.5        L2.4 revision 002 24-Nov-23 19:51 Page   2
*                                       EX03.CBL
    58   02 QNTD-ESTOQ-ATUMERC         PIC 9(03).
    59   02 PRECO-UNIT-ATUMERC         PIC 9(04)V9(02).
    60
    61 FD RELERRO LABEL RECORD IS OMITTED.
    62 01 REL-ERRO                     PIC X(80).
    63
    64 FD RELMERC LABEL RECORD IS OMITTED.
    65 01 REL-MERC                     PIC X(80).
    66
    67 WORKING-STORAGE SECTION.
    68 77 CH-CADMERC                   PIC X(04) VALUE SPACES.
    69 77 CH-MOVMERC                   PIC X(04) VALUE SPACES.
    70 77 CT-PAG-RELERRO               PIC 9(03) VALUE ZEROS.
    71 77 CT-LIN-RELERRO               PIC 9(02) VALUE 41.
    72 77 CT-PAG-RELMERC               PIC 9(03) VALUE ZEROS.
    73 77 CT-LIN-RELMERC               PIC 9(02) VALUE 41.
    74
    75 01 CAB-01-RELERRO.
    76     02 FILLER PIC X(27) VALUE SPACES.
    77     02 FILLER PIC X(24) VALUE "RELAÇÃO DE MERCADORIAS".
    78     02 FILLER PIC X(15) VALUE SPACES.
    79     02 FILLER PIC X(05) VALUE "PAG. ".
    80     02 VAR-PAG-RELERRO PIC ZZ9.
    81     02 FILLER PIC X(06) VALUE SPACES.
    82
    83 01 CAB-02-RELERRO.
    84     02 FILLER PIC X(29) VALUE SPACES.
    85     02 FILLER PIC X(22) VALUE "ERROS DE ATUALIZAÇÃO".
    86     02 FILLER PIC X(29) VALUE SPACES.
    87
    88 01 CAB-03-RELERRO.
    89     02 FILLER PIC X(03) VALUE SPACES.
    90     02 FILLER PIC X(06) VALUE "CODIGO".
    91     02 FILLER PIC X(09) VALUE SPACES.
    92     02 FILLER PIC X(11) VALUE "DESCRIÇÃO".
    93     02 FILLER PIC X(25) VALUE SPACES.
    94     02 FILLER PIC X(08) VALUE "MENSAGEM".
    95     02 FILLER PIC X(18) VALUE SPACES.
    96
    97 01 DETALHE-RELERRO.
    98     02 FILLER PIC X(04) VALUE SPACES.
    99     02 COD-DET-ERRO PIC 9(03).
   100     02 FILLER PIC X(04) VALUE SPACES.
   101     02 DESC-DET-ERRO PIC X(30).
   102     02 FILLER PIC X(01) VALUE SPACES.
   103     02 MSG-DET-ERRO PIC X(35).
   104     02 FILLER PIC X(01) VALUE SPACES.
   105
   106 01 CAB-01-RELMERC.
   107     02 FILLER PIC X(27) VALUE SPACES.
   108     02 FILLER PIC X(24) VALUE "RELAÇÃO DE MERCADORIAS".
   109     02 FILLER PIC X(15) VALUE SPACES.
   110     02 FILLER PIC X(05) VALUE "PAG. ".
   111     02 VAR-PAG-RELMERC PIC ZZ9.
   112     02 FILLER PIC X(06) VALUE SPACES.
   113
   114 01 CAB-02-RELMERC.
   115     02 FILLER PIC X(32) VALUE SPACES.
* Microsoft COBOL Version 4.5        L2.4 revision 002 24-Nov-23 19:51 Page   3
*                                       EX03.CBL
   116     02 FILLER PIC X(16) VALUE "ESTOQUE CRÍTICO".
   117     02 FILLER PIC X(31) VALUE SPACES.
   118
   119 01 CAB-03-RELMERC.
   120     02 FILLER PIC X(02) VALUE SPACES.
   121     02 FILLER PIC X(06) VALUE "CODIGO".
   122     02 FILLER PIC X(09) VALUE SPACES.
   123     02 FILLER PIC X(11) VALUE "DESCRIÇÃO".
   124     02 FILLER PIC X(13) VALUE SPACES.
   125     02 FILLER PIC X(07) VALUE "ESTOQUE".
   126     02 FILLER PIC X(05) VALUE SPACES.
   127     02 FILLER PIC X(10) VALUE "QUANTIDADE".
   128     02 FILLER PIC X(06) VALUE SPACES.
   129     02 FILLER PIC X(06) VALUE "PREÇO".
   130     02 FILLER PIC X(05) VALUE SPACES.
   131
   132 01 CAB-04-RELMERC.
   133     02 FILLER PIC X(39) VALUE SPACES.
   134     02 FILLER PIC X(07) VALUE "MÍNIMO".
   135     02 FILLER PIC X(08) VALUE SPACES.
   136     02 FILLER PIC X(07) VALUE "ESTOQUE".
   137     02 FILLER PIC X(06) VALUE SPACES.
   138     02 FILLER PIC X(09) VALUE "UNITÁRIO".
   139     02 FILLER PIC X(04) VALUE SPACES.
   140
   141 01 DETALHE-RELMERC.
   142     02 FILLER PIC X(03) VALUE SPACES.
   143     02 COD-DET-MERC PIC 9(03).
   144     02 FILLER PIC X(02) VALUE SPACES.
   145     02 DESC-DET-MERC PIC X(30).
   146     02 FILLER PIC X(06) VALUE SPACES.
   147     02 ESTOQ-MIN-DET-MERC PIC 999.
   148     02 FILLER PIC X(09) VALUE SPACES.
   149     02 QNTD-ESTOQ-DET-MERC PIC 999.
   150     02 FILLER PIC X(09) VALUE SPACES.
   151     02 PRECO-UNIT-DET-MERC PIC Z.Z99,99.
   152     02 FILLER PIC X(04) VALUE SPACES.
   153
   154 PROCEDURE DIVISION.
   155 PGM-EX03.
   156     PERFORM INICIO.
   157     PERFORM PRINCIPAL UNTIL CH-CADMERC EQUAL HIGH-VALUES
   158                         AND CH-MOVMERC EQUAL HIGH-VALUES.
   159     PERFORM TERMINO.
   160     STOP RUN.
   161
   162*================================================================*
   163
   164 INICIO.
   165     OPEN INPUT  CADMERC MOVMERC
   166          OUTPUT ATUMERC RELERRO RELMERC.
   167     PERFORM LER-CADMERC.
   168     PERFORM LER-MOVMERC.
   169
   170*================================================================*
   171
   172 LER-CADMERC.
   173     READ CADMERC AT END MOVE HIGH-VALUES TO CH-CADMERC.
* Microsoft COBOL Version 4.5        L2.4 revision 002 24-Nov-23 19:51 Page   4
*                                       EX03.CBL
   174     IF CH-CADMERC EQUAL HIGH-VALUES
   175        NEXT SENTENCE
   176     ELSE
   177        MOVE COD-MERC-CADMERC TO CH-CADMERC.
   178
   179 LER-MOVMERC.
   180     READ MOVMERC AT END MOVE HIGH-VALUES TO CH-MOVMERC.
   181     IF CH-MOVMERC EQUAL HIGH-VALUES
   182        NEXT SENTENCE
   183     ELSE
   184        MOVE COD-MERC-MOVMERC TO CH-MOVMERC.
   185
   186*================================================================*
   187
   188 PRINCIPAL.
   189     PERFORM VERIFICA-CABECALHO.
   190
   191     IF CH-CADMERC EQUAL CH-MOVMERC
   192         PERFORM CADMERC-IGUAL-MOVMERC
   193         PERFORM LER-CADMERC
   194         PERFORM LER-MOVMERC
   195     ELSE
   196         IF CH-CADMERC LESS CH-MOVMERC
   197             PERFORM CADMERC-MENOR
   198             PERFORM LER-CADMERC
   199         ELSE
   200             PERFORM MOVMERC-MENOR
   201             PERFORM LER-MOVMERC
   202         END-IF
   203     END-IF.
   204
   205*================================================================*
   206*        1 - Inclusao;   2 - Alteracao;  3 - Exclusao.
   207
   208 CADMERC-IGUAL-MOVMERC.
   209     EVALUATE TRUE
   210       WHEN TP-ATUALIZACAO-MOVMERC EQUAL '1'
   211         MOVE "INCLUSÃO DE REG. JÁ EXISTENTE" TO MSG-DET-ERRO
   212         PERFORM IMP-DET-RELERRO
   213         PERFORM GRAVAR-CADMERC-ATUMERC
   214
   215       WHEN TP-ATUALIZACAO-MOVMERC EQUAL '2'
   216         PERFORM GRAVAR-MOVMERC-ATUMERC
   217
   218       WHEN TP-ATUALIZACAO-MOVMERC EQUAL '3'
   219         NEXT SENTENCE
   220     END-EVALUATE.
   221
   222 CADMERC-MENOR.
   223     PERFORM GRAVAR-CADMERC-ATUMERC.
   224
   225 MOVMERC-MENOR.
   226     EVALUATE TRUE
   227       WHEN TP-ATUALIZACAO-MOVMERC EQUAL '1'
   228         PERFORM GRAVAR-MOVMERC-ATUMERC
   229
   230       WHEN TP-ATUALIZACAO-MOVMERC EQUAL '2'
   231         MOVE "ALTERAÇÃO DE REG. NÃO EXISTENTE" TO MSG-DET-ERRO
* Microsoft COBOL Version 4.5        L2.4 revision 002 24-Nov-23 19:51 Page   5
*                                       EX03.CBL
   232         PERFORM IMP-DET-RELERRO
   233
   234       WHEN TP-ATUALIZACAO-MOVMERC EQUAL '3'
   235         MOVE "EXCLUSAO DE REG. NÃO EXISTENTE" TO MSG-DET-ERRO
   236         PERFORM IMP-DET-RELERRO
   237     END-EVALUATE.
   238
   239*================================================================*
   240
   241 GRAVAR-CADMERC-ATUMERC.
   242     MOVE COD-MERC-CADMERC   TO COD-MERC-ATUMERC.
   243     MOVE DESCRICAO-CADMERC  TO DESCRICAO-ATUMERC.
   244     MOVE ESTOQ-MIN-CADMERC  TO ESTOQ-MIN-ATUMERC.
   245     MOVE QNTD-ESTOQ-CADMERC TO QNTD-ESTOQ-ATUMERC.
   246     MOVE PRECO-UNIT-CADMERC TO PRECO-UNIT-ATUMERC.
   247     WRITE REG-ATUMERC.
   248     PERFORM IMP-DET-RELMERC.
   249
   250 GRAVAR-MOVMERC-ATUMERC.
   251     MOVE COD-MERC-MOVMERC   TO COD-MERC-ATUMERC.
   252     MOVE DESCRICAO-MOVMERC  TO DESCRICAO-ATUMERC.
   253     MOVE ESTOQ-MIN-MOVMERC  TO ESTOQ-MIN-ATUMERC.
   254     MOVE QNTD-ESTOQ-MOVMERC TO QNTD-ESTOQ-ATUMERC.
   255     MOVE PRECO-UNIT-MOVMERC TO PRECO-UNIT-ATUMERC.
   256     WRITE REG-ATUMERC.
   257     PERFORM IMP-DET-RELMERC.
   258
   259*================================================================*
   260
   261 IMP-DET-RELERRO.
   262     MOVE COD-MERC-MOVMERC  TO COD-DET-ERRO.
   263     MOVE DESCRICAO-MOVMERC TO DESC-DET-ERRO.
   264     WRITE REL-ERRO FROM DETALHE-RELERRO AFTER
   265         ADVANCING 1 LINE.
   266     ADD 1 TO CT-LIN-RELERRO.
   267
   268 IMP-DET-RELMERC.
   269     IF QNTD-ESTOQ-ATUMERC NOT GREATER THAN ESTOQ-MIN-ATUMERC
   270        MOVE COD-MERC-ATUMERC   TO COD-DET-MERC
   271        MOVE DESCRICAO-ATUMERC  TO DESC-DET-MERC
   272        MOVE ESTOQ-MIN-ATUMERC  TO ESTOQ-MIN-DET-MERC
   273        MOVE QNTD-ESTOQ-ATUMERC TO QNTD-ESTOQ-DET-MERC
   274        MOVE PRECO-UNIT-ATUMERC TO PRECO-UNIT-DET-MERC
   275        WRITE REL-MERC FROM DETALHE-RELMERC AFTER
   276            ADVANCING 1 LINE
   277        ADD 1 TO CT-LIN-RELMERC.
   278
   279*================================================================*
   280
   281 VERIFICA-CABECALHO.
   282     IF CT-LIN-RELERRO GREATER THAN 40
   283        PERFORM CABECALHO-RELERRO.
   284
   285     IF CT-LIN-RELMERC GREATER THAN 40
   286        PERFORM CABECALHO-RELMERC.
   287
   288 CABECALHO-RELERRO.
   289     ADD 1 TO CT-PAG-RELERRO.
* Microsoft COBOL Version 4.5        L2.4 revision 002 24-Nov-23 19:51 Page   6
*                                       EX03.CBL
   290     MOVE CT-PAG-RELERRO TO VAR-PAG-RELERRO.
   291     MOVE SPACES TO REL-ERRO.
   292
   293     WRITE REL-ERRO AFTER ADVANCING PAGE.
   294     WRITE REL-ERRO FROM CAB-01-RELERRO
   295           AFTER ADVANCING 1 LINE.
   296     WRITE REL-ERRO FROM CAB-02-RELERRO
   297           AFTER ADVANCING 2 LINES.
   298     WRITE REL-ERRO FROM CAB-03-RELERRO
   299           AFTER ADVANCING 2 LINES.
   300     MOVE SPACES TO REL-ERRO.
   301     WRITE REL-ERRO AFTER ADVANCING 1 LINE.
   302
   303     MOVE ZEROES TO CT-LIN-RELERRO.
   304
   305 CABECALHO-RELMERC.
   306     ADD 1 TO CT-PAG-RELMERC.
   307     MOVE CT-PAG-RELMERC TO VAR-PAG-RELMERC.
   308
   309     MOVE SPACES TO REL-MERC.
   310     WRITE REL-MERC AFTER ADVANCING PAGE.
   311     WRITE REL-MERC FROM CAB-01-RELMERC
   312           AFTER ADVANCING 1 LINE.
   313     WRITE REL-MERC FROM CAB-02-RELMERC
   314           AFTER ADVANCING 2 LINES.
   315     WRITE REL-MERC FROM CAB-03-RELMERC
   316           AFTER ADVANCING 2 LINES.
   317     WRITE REL-MERC FROM CAB-04-RELMERC
   318           AFTER ADVANCING 1 LINE.
   319     MOVE SPACES TO REL-MERC.
   320     WRITE REL-MERC AFTER ADVANCING 1 LINE.
   321
   322     MOVE ZEROES TO CT-LIN-RELMERC.
   323
   324*================================================================*
   325
   326 TERMINO.
   327        CLOSE CADMERC MOVMERC ATUMERC RELERRO RELMERC.
* Microsoft COBOL Version 4.5        L2.4 revision 002
* (C)Copyright Microsoft Corp 1984, 1991       URN AXUPA/MS0/000000
*                                              REF GNB-024050002A7
*
* Total Messages:     0
* Data:        2564     Code:        1582     Dictionary:        3898
