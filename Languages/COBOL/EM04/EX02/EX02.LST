* Microsoft COBOL Version 4.5        L2.4 revision 002 24-Nov-23 23:04 Page   1
*                                       EX02.CBL
* Options: LIST(EX02.LST) ASMLIST(EX02.GRP)
     1 IDENTIFICATION DIVISION.
     2 PROGRAM-ID.     EX02.
     3 AUTHOR.         LUIZ HENRIQUE DE SANTANA
     4                 GABRIEL GOMES DA CRUZ.
     5 INSTALLATION.   FATEC-SP.
     6 DATE-WRITTEN.   24/11/2023.
     7 DATE-COMPILED. 24-Nov-23 23:04.
     8 SECURITY.       APENAS O AUTOR PODE MODIFICA-LO.
     9*REMARKS.        FAZER O BALANCE-LINE, GERANDO UM ARQUIVO
    10*                ATUALIZADO E UM RELATORIO DE ATUALIZACAO.
    11
    12 ENVIRONMENT DIVISION.
    13 CONFIGURATION SECTION.
    14 SOURCE-COMPUTER. IBM-PC.
    15 OBJECT-COMPUTER. IBM-PC.
    16 SPECIAL-NAMES. DECIMAL-POINT IS COMMA.
    17
    18 INPUT-OUTPUT SECTION.
    19 FILE-CONTROL.
    20     SELECT CADANT ASSIGN TO DISK ORGANIZATION
    21         IS LINE SEQUENTIAL.
    22     SELECT ARQMOV ASSIGN TO DISK ORGANIZATION
    23         IS LINE SEQUENTIAL.
    24     SELECT CADATU ASSIGN TO DISK ORGANIZATION
    25         IS LINE SEQUENTIAL.
    26     SELECT RELOCORR ASSIGN TO DISK.
    27
    28 DATA DIVISION.
    29 FILE SECTION.
    30
    31 FD CADANT LABEL RECORD ARE STANDARD
    32     VALUE OF FILE-ID IS "CADANT.DAT".
    33 01 REG-ANT.
    34    02 CC-ANT        PIC 9(03).
    35    02 TIPO-ANT      PIC X(01).
    36    02 ENDER-ANT     PIC X(50).
    37
    38 FD ARQMOV LABEL RECORD ARE STANDARD
    39     VALUE OF FILE-ID IS "ARQMOV.DAT".
    40 01 REG-MOV.
    41     02 CC-MOV       PIC 9(03).
    42     02 TIPO-MOV     PIC X(01).
    43     02 ENDER-MOV    PIC X(50).
    44
    45 FD CADATU LABEL RECORD ARE STANDARD
    46     VALUE OF FILE-ID IS "CADATU.DAT".
    47 01 REG-ATU.
    48     02 CC-ATU       PIC 9(03).
    49     02 TIPO-ATU     PIC X(01).
    50     02 ENDER-ATU    PIC X(50).
    51
    52 FD RELOCORR LABEL RECORD IS OMITTED.
    53 01 DET-OCCOR        PIC X(80).
    54
    55 WORKING-STORAGE SECTION.
    56 77 CH-CADANT        PIC X(04) VALUE SPACES.
    57 77 CH-ARQMOV        PIC X(04) VALUE SPACES.
* Microsoft COBOL Version 4.5        L2.4 revision 002 24-Nov-23 23:04 Page   2
*                                       EX02.CBL
    58 77 CT-PAG           PIC 9(03) VALUE ZEROS.
    59 77 CT-LIN           PIC 9(02) VALUE 41.
    60
    61 01 CAB-01.
    62     02 FILLER PIC X(26) VALUE SPACES.
    63     02 FILLER PIC X(26) VALUE "Relação de atualização".
    64     02 FILLER PIC X(14) VALUE SPACES.
    65     02 FILLER PIC X(05) VALUE "Pag. ".
    66     02 VAR-PAG PIC ZZ9.
    67     02 FILLER PIC X(06) VALUE SPACES.
    68
    69 01 CAB-02.
    70     02 FILLER PIC X(06) VALUE SPACES.
    71     02 FILLER PIC X(06) VALUE "codigo".
    72     02 FILLER PIC X(06) VALUE SPACES.
    73     02 FILLER PIC X(04) VALUE "tipo".
    74     02 FILLER PIC X(15) VALUE SPACES.
    75     02 FILLER PIC X(08) VALUE "mensagem".
    76     02 FILLER PIC X(35) VALUE SPACES.
    77
    78 01 DETALHE.
    79     02 FILLER PIC X(08) VALUE SPACES.
    80     02 CC-DET PIC 999.
    81     02 FILLER PIC X(08) VALUE SPACES.
    82     02 TIPO-DET PIC X(01).
    83     02 FILLER PIC X(08) VALUE SPACES.
    84     02 MENSAGEM-DET PIC X(40).
    85     02 FILLER PIC X(12) VALUE SPACES.
    86
    87 PROCEDURE DIVISION.
    88 PGM-EX02.
    89     PERFORM INICIO.
    90     PERFORM PRINCIPAL UNTIL CH-CADANT EQUAL HIGH-VALUES AND
    91                         CH-ARQMOV EQUAL HIGH-VALUES.
    92     PERFORM TERMINO.
    93     STOP RUN.
    94
    95*================================================================*
    96
    97 INICIO.
    98        OPEN INPUT CADANT ARQMOV OUTPUT CADATU RELOCORR.
    99        PERFORM LER-CADANT.
   100        PERFORM LER-ARQMOV.
   101*================================================================*
   102
   103 LER-CADANT.
   104     READ CADANT AT END MOVE HIGH-VALUES TO CH-CADANT.
   105     IF CH-CADANT EQUAL HIGH-VALUES
   106         NEXT SENTENCE
   107     ELSE
   108         MOVE CC-ANT TO CH-CADANT
   109     END-IF.
   110
   111 LER-ARQMOV.
   112     READ ARQMOV AT END MOVE HIGH-VALUES TO CH-ARQMOV.
   113     IF CH-ARQMOV EQUAL HIGH-VALUES
   114         NEXT SENTENCE
   115     ELSE
* Microsoft COBOL Version 4.5        L2.4 revision 002 24-Nov-23 23:04 Page   3
*                                       EX02.CBL
   116         MOVE CC-MOV TO CH-ARQMOV
   117     END-IF.
   118*================================================================*
   119
   120 PRINCIPAL.
   121     IF CT-LIN GREATER 40
   122         PERFORM CABECALHO.
   123
   124     IF CH-CADANT EQUAL CH-ARQMOV
   125         PERFORM CADANT-IGUAL-ARQMOV
   126         PERFORM LER-CADANT
   127         PERFORM LER-ARQMOV
   128     ELSE
   129         IF CH-CADANT LESS CH-ARQMOV
   130             PERFORM CADANT-MENOR
   131             PERFORM LER-CADANT
   132         ELSE
   133             PERFORM ARQMOV-MENOR
   134             PERFORM LER-ARQMOV
   135         END-IF
   136     END-IF.
   137*================================================================*
   138
   139 CADANT-IGUAL-ARQMOV.
   140     EVALUATE TRUE
   141       WHEN TIPO-MOV EQUAL 'A'
   142         MOVE "REGISTRO SUBSTITUIDO" TO MENSAGEM-DET
   143         MOVE CC-ANT TO CC-DET
   144         MOVE TIPO-ANT TO TIPO-DET
   145         WRITE DET-OCCOR FROM DETALHE AFTER ADVANCING 1 LINE
   146         ADD 1 TO CT-LIN
   147
   148         MOVE "REGISTRO SUBSTITUTO" TO MENSAGEM-DET
   149         MOVE CC-MOV TO CC-DET
   150         MOVE TIPO-MOV TO TIPO-DET
   151         PERFORM GRAVAR-ARQMOV-CADATU
   152
   153       WHEN TIPO-MOV EQUAL 'E'
   154         MOVE "REGISTRO EXCLUIDO" TO MENSAGEM-DET
   155         MOVE CC-ANT TO CC-DET
   156         MOVE TIPO-ANT TO TIPO-DET
   157
   158       WHEN TIPO-MOV EQUAL 'I'
   159         MOVE "INCLUSÃO P/REG. JÁ EXISTENTE" TO MENSAGEM-DET
   160         MOVE CC-MOV TO CC-DET
   161         MOVE TIPO-MOV TO TIPO-DET
   162         PERFORM GRAVAR-CADANT-CADATU
   163     END-EVALUATE.
   164
   165     WRITE DET-OCCOR FROM DETALHE AFTER ADVANCING 1 LINE.
   166     ADD 1 TO CT-LIN.
   167
   168 CADANT-MENOR.
   169     PERFORM GRAVAR-CADANT-CADATU.
   170
   171 ARQMOV-MENOR.
   172     MOVE CC-MOV TO CC-DET.
   173     MOVE TIPO-MOV TO TIPO-DET.
* Microsoft COBOL Version 4.5        L2.4 revision 002 24-Nov-23 23:04 Page   4
*                                       EX02.CBL
   174
   175     EVALUATE TRUE
   176       WHEN TIPO-MOV EQUAL 'A'
   177         MOVE "ALTERAÇÃO P/REG. INEXISTENTE" TO MENSAGEM-DET
   178         WRITE DET-OCCOR FROM DETALHE AFTER ADVANCING 1 LINE
   179         ADD 1 TO CT-LIN
   180
   181       WHEN TIPO-MOV EQUAL 'E'
   182         MOVE "EXCLUSÃO P/REG. INEXISTENTE" TO MENSAGEM-DET
   183         WRITE DET-OCCOR FROM DETALHE AFTER ADVANCING 1 LINE
   184         ADD 1 TO CT-LIN
   185
   186       WHEN TIPO-MOV EQUAL 'I'
   187         MOVE "REGISTRO INCLUIDO" TO MENSAGEM-DET
   188         WRITE DET-OCCOR FROM DETALHE AFTER ADVANCING 1 LINE
   189         ADD 1 TO CT-LIN
   190         PERFORM GRAVAR-ARQMOV-CADATU
   191     END-EVALUATE.
   192
   193*================================================================*
   194
   195 GRAVAR-CADANT-CADATU.
   196     MOVE CC-ANT     TO CC-ATU.
   197     MOVE TIPO-ANT   TO TIPO-ATU.
   198     MOVE ENDER-ANT  TO ENDER-ATU.
   199     WRITE REG-ATU.
   200
   201 GRAVAR-ARQMOV-CADATU.
   202     MOVE CC-MOV     TO CC-ATU.
   203     MOVE TIPO-MOV   TO TIPO-ATU.
   204     MOVE ENDER-MOV  TO ENDER-ATU.
   205     WRITE REG-ATU.
   206*================================================================*
   207
   208 CABECALHO.
   209     ADD 1 TO CT-PAG.
   210     MOVE CT-PAG TO VAR-PAG.
   211     MOVE SPACES TO DET-OCCOR.
   212     WRITE DET-OCCOR AFTER ADVANCING PAGE.
   213     WRITE DET-OCCOR FROM CAB-01 AFTER ADVANCING 1 LINE.
   214     WRITE DET-OCCOR FROM CAB-02 AFTER ADVANCING 2 LINES.
   215     MOVE 0 TO CT-LIN.
   216*================================================================*
   217
   218 TERMINO.
   219     CLOSE CADANT ARQMOV CADATU RELOCORR.
* Microsoft COBOL Version 4.5        L2.4 revision 002
* (C)Copyright Microsoft Corp 1984, 1991       URN AXUPA/MS0/000000
*                                              REF GNB-024050002A7
*
* Total Messages:     0
* Data:        1836     Code:        1319     Dictionary:        2313
